

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Extracting Shock Data for Feature Extraction - Initial Plots for BPF &mdash; fyp2021-ph720 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-rendered-html.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> fyp2021-ph720
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/setup.html">Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Example Galleries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Example Gallery with some plots</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre Processing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Pre Processing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fyp2021-ph720</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Extracting Shock Data for Feature Extraction - Initial Plots for BPF</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/_examples/Pre-processing/plot_Extracting_Shock_Samples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-pre-processing-plot-extracting-shock-samples-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="extracting-shock-data-for-feature-extraction-initial-plots-for-bpf">
<span id="sphx-glr-examples-pre-processing-plot-extracting-shock-samples-py"></span><h1>Extracting Shock Data for Feature Extraction - Initial Plots for BPF<a class="headerlink" href="#extracting-shock-data-for-feature-extraction-initial-plots-for-bpf" title="Permalink to this headline">Â¶</a></h1>
<p>Fetching shock instances (including symptoms that indicate severe dengue) and plotting the data.
Processing of data will follow this step</p>
<p># Importing Libraries, Definitions and Data Loading</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1"># Generic</span>
 <span class="kn">import</span> <span class="nn">os</span>
 <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
 <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
 <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
 <span class="kn">import</span> <span class="nn">glob</span>
 <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
 <span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>
 <span class="kn">import</span> <span class="nn">plotly.io</span> <span class="k">as</span> <span class="nn">pio</span>

 <span class="n">Terminal</span> <span class="o">=</span> <span class="kc">True</span>

 <span class="n">SQI_clinical_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;..\..\..\..\OUCRU\Outputs\Complete_SQIs_with_Clinical.csv&#39;</span>
 <span class="n">Raw_signals</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;..\..\..\..\OUCRU\Outputs\Raw_signals.csv&#39;</span>


 <span class="c1">#Loading SQI Matched with clinitcal to the Dataframe</span>
 <span class="n">SQI_C</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">SQI_clinical_file</span><span class="p">)</span>
 <span class="n">Raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Raw_signals</span><span class="p">)</span>

 <span class="k">if</span> <span class="n">Terminal</span><span class="p">:</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> SQI with Clinical Match:&quot;</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">SQI_C</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Raw Signals&quot;</span><span class="p">)</span>
     <span class="nb">print</span><span class="p">(</span><span class="n">Raw</span><span class="p">)</span>

 <span class="c1">#List of events explored</span>
 <span class="n">event</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;event_shock&#39;</span><span class="p">,</span> <span class="s1">&#39;reshock24&#39;</span><span class="p">,</span><span class="s1">&#39;diagnosis_admission&#39;</span><span class="p">,</span>\
      <span class="s1">&#39;ascites&#39;</span><span class="p">,</span> <span class="s1">&#39;respiratory_distress&#39;</span><span class="p">,</span> <span class="s1">&#39;ventilation_cannula&#39;</span><span class="p">,</span> \
      <span class="s1">&#39;ventilation_mechanical&#39;</span><span class="p">,</span> <span class="s1">&#39;ventilation_ncpap&#39;</span><span class="p">,</span> <span class="s1">&#39;bleeding_severe&#39;</span><span class="p">,</span> \
      <span class="s1">&#39;cns_abnormal&#39;</span><span class="p">,</span> <span class="s1">&#39;liver_mild&#39;</span><span class="p">,</span> <span class="s1">&#39;pleural_effusion&#39;</span><span class="p">,</span> <span class="s1">&#39;skidney&#39;</span><span class="p">]</span>

 <span class="n">shock_ad</span> <span class="o">=</span> <span class="s1">&#39;shock_admission&#39;</span> <span class="c1">#excluding it from the prior list as we are treating this differently</span>

 <span class="c1">#Study_no list for ease of use</span>
 <span class="n">patient_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;003-2162&#39;</span><span class="p">]</span>
 <span class="c1">#[&#39;003-2009&#39;, &#39;003-2012&#39;,&#39;003-2023&#39;,&#39;003-2028&#39;,&#39;003-2103&#39;,&#39;003-2104&#39;,&#39;003-2109&#39;, &#39;003-2110&#39;, &#39;003-2162&#39;]</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span> SQI with Clinical Match:
       Unnamed: 0               timedelta                  PPG_w_s                  PPG_w_f  ...  cns_abnormal  liver_mild  pleural_effusion  skidney
0               0  0 days 00:05:00.010000  2020-07-28 16:04:20.104  2020-07-28 16:04:50.094  ...           NaN         NaN               NaN      NaN
1               1  0 days 00:05:30.010000  2020-07-28 16:04:50.104  2020-07-28 16:05:20.094  ...           NaN         NaN               NaN      NaN
2               2  0 days 00:06:00.010000  2020-07-28 16:05:20.104  2020-07-28 16:05:50.094  ...           NaN         NaN               NaN      NaN
3               3  0 days 00:06:30.010000  2020-07-28 16:05:50.104  2020-07-28 16:06:20.094  ...           NaN         NaN               NaN      NaN
4               4  0 days 00:07:00.010000  2020-07-28 16:06:20.104  2020-07-28 16:06:50.094  ...           NaN         NaN               NaN      NaN
...           ...                     ...                      ...                      ...  ...           ...         ...               ...      ...
12698       12698  0 days 15:03:30.010000  2020-07-21 05:08:37.203  2020-07-21 05:09:07.193  ...           NaN         NaN               NaN      NaN
12699       12699  0 days 15:04:00.010000  2020-07-21 05:09:07.203  2020-07-21 05:09:37.193  ...           NaN         NaN               NaN      NaN
12700       12700  0 days 15:04:30.010000  2020-07-21 05:09:37.203  2020-07-21 05:10:07.193  ...           NaN         NaN               NaN      NaN
12701       12701  0 days 15:05:00.010000  2020-07-21 05:10:07.203  2020-07-21 05:10:37.193  ...           NaN         NaN               NaN      NaN
12702       12702  0 days 15:05:30.010000  2020-07-21 05:10:37.203  2020-07-21 05:10:52.883  ...           NaN         NaN               NaN      NaN

[12703 rows x 42 columns]

 Raw Signals
                       timedelta      idx  PLETH  IR_ADC             PPG_Datetime     PLETH_bpf  IR_ADC_bpf  study_no  study_no_rec
0         0 days 00:05:00.010000    29913  10803  135438  2020-07-28 16:04:20.104   -347.936641   -0.439129  003-2009             0
1         0 days 00:05:00.020000    29914  10609  135067  2020-07-28 16:04:20.114  -2051.585777  -16.222886  003-2009             0
2         0 days 00:05:00.030000    29915  10659  134754  2020-07-28 16:04:20.124  -5424.102666  -96.673830  003-2009             0
3         0 days 00:05:00.040000    29916  10983  134473  2020-07-28 16:04:20.134  -8735.859953 -286.584242  003-2009             0
4         0 days 00:05:00.050000    29917  11734  134286  2020-07-28 16:04:20.144 -10096.052116 -548.629881  003-2009             0
...                          ...      ...    ...     ...                      ...           ...         ...       ...           ...
38090494  0 days 15:05:45.650000  5434392  29757  237669  2020-07-21 05:10:52.843   2225.061853  -71.816763  003-2162             0
38090495  0 days 15:05:45.660000  5434393  28948  237769  2020-07-21 05:10:52.853   2087.608183  -63.166235  003-2162             0
38090496  0 days 15:05:45.670000  5434394  28102  237833  2020-07-21 05:10:52.863   1924.112544  -54.688387  003-2162             0
38090497  0 days 15:05:45.680000  5434395  27238  237917  2020-07-21 05:10:52.873   1729.246675  -46.064908  003-2162             0
38090498  0 days 15:05:45.690000  5434396  26337  238017  2020-07-21 05:10:52.883   1506.537732  -44.085682  003-2162             0

[38090499 rows x 9 columns]
</pre></div>
</div>
<p>Turning signal window rows with an event to âkeep = Trueâ</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>53
54
55
56
57
58
59
60</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">SQI_C</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="p">)):</span>
     <span class="n">event_s</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
     <span class="n">SQI_C</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">][</span><span class="n">SQI_C</span><span class="p">[</span><span class="n">event_s</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Total &quot;</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot; events:&quot;</span><span class="p">)</span>

 <span class="c1">#Optional Save</span>
 <span class="c1">#SQI_C.to_csv(r&#39;..\..\..\..\OUCRU\Outputs\Complete_SQIs_with_Clinical_keep.csv&#39;)</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  event_shock  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  reshock24  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  diagnosis_admission  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  ascites  events:

 Total  respiratory_distress  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  ventilation_cannula  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  ventilation_mechanical  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  ventilation_ncpap  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  bleeding_severe  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  cns_abnormal  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  liver_mild  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  pleural_effusion  events:
D:\FILES\Desktop\Dissertation ICL\Git\main\examples\Pre-processing\plot_Extracting_Shock_Samples.py:56: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  SQI_C[&#39;keep&#39;][SQI_C[event_s] == True] = True

 Total  skidney  events:
</pre></div>
</div>
<p>Plotting IR_ADC BPF and PLETH BPF on interactive graphs, together with the events (i.e. event of shock and whether or not the patient was admitted with shock)</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">patient_list</span><span class="p">)):</span>
     <span class="c1">#Plotting IR_ADC BPF signals with events</span>
     <span class="c1">#fig = make_subplots(rows=2, cols=1)</span>
     <span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39;IR_ADC_BPF over Time for patient &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
     <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">layout_title_text</span> <span class="o">=</span> <span class="n">title_str</span><span class="p">)</span>
     <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Raw</span><span class="o">.</span><span class="n">PPG_Datetime</span><span class="p">[</span><span class="n">Raw</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">y</span> <span class="o">=</span>  <span class="n">Raw</span><span class="o">.</span><span class="n">IR_ADC_bpf</span><span class="p">[</span><span class="n">Raw</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;IR_ADC&#39;</span><span class="p">))</span><span class="c1">#,),row=1,col=1)</span>
     <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">SQI_C</span><span class="p">[(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">keep</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
         <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">PPG_w_s</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="c1"># annotation_text=&quot;Shock&quot;)#, annotation_position=&quot;top left&quot;, annotation_font_size=20, annotation_font_color=&quot;red&quot;)</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
             <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">PPG_w_s</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Raw</span><span class="p">[</span><span class="s1">&#39;PLETH&#39;</span><span class="p">][(</span><span class="n">Raw</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Raw</span><span class="o">.</span><span class="n">PPG_Datetime</span> <span class="o">&gt;=</span> <span class="n">row</span><span class="o">.</span><span class="n">PPG_w_s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Raw</span><span class="o">.</span><span class="n">PPG_Datetime</span> <span class="o">&lt;</span> <span class="n">row</span><span class="o">.</span><span class="n">PPG_w_f</span><span class="p">)]],</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Shock&quot;</span> <span class="p">))</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">SQI_C</span><span class="p">[(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">shock_admission</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
         <span class="n">fig</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span>
         <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x domain&quot;</span><span class="p">,</span>
         <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y domain&quot;</span><span class="p">,</span>
         <span class="c1"># The arrow head will be 25% along the x axis, starting from the left</span>
         <span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
         <span class="c1"># The arrow head will be 40% along the y axis, starting from the bottom</span>
         <span class="n">y</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
         <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Admitted with Shock&quot;</span><span class="p">,</span>
         <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
             <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
             <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RED&quot;</span>
             <span class="p">)</span>
                         <span class="p">)</span>


     <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">rangeslider_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
     <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;IR_ADC&quot;</span><span class="p">)</span>
     <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

     <span class="c1"># #IGNORE, this is to save locally</span>
     <span class="c1"># imagepath1 = &quot;D:\FILES\Desktop\Dissertation ICL\OUCRU\Outputs\Images_BPF\PNG&quot;</span>
     <span class="c1"># imagepath2 = &quot;D:\FILES\Desktop\Dissertation ICL\OUCRU\Outputs\Images_BPF\SVG&quot;</span>
     <span class="c1"># imagepath3 = &quot;D:\FILES\Desktop\Dissertation ICL\OUCRU\Outputs\Images_BPF\HTML&quot;</span>
     <span class="c1"># img_title1 = os.path.join(imagepath1,title_str)</span>
     <span class="c1"># img_title2 = os.path.join(imagepath2,title_str)</span>
     <span class="c1"># img_title3 = os.path.join(imagepath3,title_str)</span>
     <span class="c1"># img_s1 = img_title1 + &quot;.png&quot;</span>
     <span class="c1"># img_s2 = img_title2 + &quot;.svg&quot;</span>
     <span class="c1"># img_s3 = img_title3 + &quot;.html&quot;</span>
     <span class="c1"># fig.write_image(img_s1)</span>
     <span class="c1"># fig.write_image(img_s2)</span>
     <span class="c1"># fig.write_html(img_s3)</span>

     <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


     <span class="c1">#Plotting PLETH BPF and events</span>
     <span class="c1">#fig = make_subplots(rows=2, cols=1)</span>
     <span class="n">title_str2</span> <span class="o">=</span> <span class="s1">&#39;PLETH_BPF over Time for patient &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
     <span class="n">fig2</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">layout_title_text</span> <span class="o">=</span> <span class="n">title_str2</span><span class="p">)</span>
     <span class="n">fig2</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Raw</span><span class="o">.</span><span class="n">PPG_Datetime</span><span class="p">[</span><span class="n">Raw</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">y</span> <span class="o">=</span>  <span class="n">Raw</span><span class="o">.</span><span class="n">PLETH_bpf</span><span class="p">[</span><span class="n">Raw</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;PLETH&#39;</span><span class="p">))</span><span class="c1">#,),row=1,col=1)</span>
     <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">SQI_C</span><span class="p">[(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">keep</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
         <span class="n">fig2</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">PPG_w_s</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="c1">#, annotation_text=&quot;Shock&quot;)#, annotation_position=&quot;top left&quot;, annotation_font_size=20, annotation_font_color=&quot;red&quot;)</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
             <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">PPG_w_s</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Raw</span><span class="p">[</span><span class="s1">&#39;PLETH&#39;</span><span class="p">][(</span><span class="n">Raw</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Raw</span><span class="o">.</span><span class="n">PPG_Datetime</span> <span class="o">&gt;=</span> <span class="n">row</span><span class="o">.</span><span class="n">PPG_w_s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Raw</span><span class="o">.</span><span class="n">PPG_Datetime</span> <span class="o">&lt;</span> <span class="n">row</span><span class="o">.</span><span class="n">PPG_w_f</span><span class="p">)]],</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Shock&quot;</span> <span class="p">))</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">SQI_C</span><span class="p">[(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">study_no</span> <span class="o">==</span> <span class="n">patient_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SQI_C</span><span class="o">.</span><span class="n">shock_admission</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
         <span class="n">fig2</span><span class="o">.</span><span class="n">add_annotation</span><span class="p">(</span>
         <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x domain&quot;</span><span class="p">,</span>
         <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y domain&quot;</span><span class="p">,</span>
         <span class="c1"># The arrow head will be 25% along the x axis, starting from the left</span>
         <span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
         <span class="c1"># The arrow head will be 40% along the y axis, starting from the bottom</span>
         <span class="n">y</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
         <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Admitted with Shock&quot;</span><span class="p">,</span>
         <span class="n">showarrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">font</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
             <span class="n">family</span><span class="o">=</span><span class="s2">&quot;Courier New, monospace&quot;</span><span class="p">,</span>
             <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;RED&quot;</span>
             <span class="p">)</span>
                         <span class="p">)</span>


     <span class="n">fig2</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">rangeslider_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">fig2</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
     <span class="n">fig2</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;PLETH&quot;</span><span class="p">)</span>
     <span class="n">fig2</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


     <span class="c1"># #IGNORE, this is to save locally</span>
     <span class="c1"># img_title4 = os.path.join(imagepath1,title_str2)</span>
     <span class="c1"># img_title5 = os.path.join(imagepath2,title_str2)</span>
     <span class="c1"># img_title6 = os.path.join(imagepath3,title_str2)</span>
     <span class="c1"># img_s4 = img_title4 + &quot;.png&quot;</span>
     <span class="c1"># img_s5 = img_title5 + &quot;.svg&quot;</span>
     <span class="c1"># img_s6 = img_title6 + &quot;.html&quot;</span>
     <span class="c1"># fig2.write_image(img_s4)</span>
     <span class="c1"># fig2.write_image(img_s5)</span>
     <span class="c1"># fig2.write_html(img_s6)</span>

     <span class="n">fig2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>




 <span class="c1">#MULTIPLE plots same figure</span>

 <span class="c1">#fig.append_trace(go.Scatter(x = Raw.PPG_Datetime[Raw.study_no == &#39;003-2009&#39;], y =  Raw.PLETH[Raw.study_no == &#39;003-2009&#39;], name=&#39;Pleth&#39;), row=2, col=1)</span>
 <span class="c1">#for index, row in SQI_C[(SQI_C.study_no == &#39;003-2009&#39;) &amp; (SQI_C.keep == True)].iterrows():</span>
 <span class="c1">#    fig.add_vline(x = row.PPG_w_s, line_width=3, line_dash=&quot;dash&quot;, line_color=&quot;red&quot;, row=2, col=1)</span>


 <span class="c1">#fig.update_yaxes(title_text=&quot;Infrared&quot;, row=1, col=1)</span>
 <span class="c1">#fig.update_yaxes(title_text=&quot;Pleth&quot;, row=2, col=1)</span>

 <span class="c1"># fig.update_xaxes(rangeslider_visible=True, row=1, col=1)</span>
 <span class="c1"># fig.update_xaxes(title_text=&quot;Date&quot;, row=1, col=1)</span>
 <span class="c1"># fig.update_xaxes(rangeslider_visible=True, row=2, col=1)</span>
 <span class="c1"># fig.update_xaxes(title_text=&quot;Date&quot;, row=2, col=1)</span>

 <span class="c1">#fig.update_layout(height=1000, width=1000, title_text=&quot; IR_ADC and PLETH Plots for Patient 003-2009&quot;)</span>
</pre></div>
</td></tr></table></div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 5 minutes  44.614 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-pre-processing-plot-extracting-shock-samples-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/28112687f66335c4a7b826d5f2f06fb2/plot_Extracting_Shock_Samples.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_Extracting_Shock_Samples.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/561b28943a36aa178262e2446eaae58c/plot_Extracting_Shock_Samples.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_Extracting_Shock_Samples.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Philippos Arkis Hadjimarkou.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>